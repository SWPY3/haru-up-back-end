### 환경 설정 (필요하면 포트/URL만 수정)
@host = localhost
@port = 8080
@baseUrl = http://{{host}}:{{port}}

### 1. SNS 로그인 - 신규 회원 (또는 기존 회원 재로그인)
# @name snsLogin
POST {{baseUrl}}/api/member/auth/sns-login
Content-Type: application/json

{
  "loginType": "KAKAO",
  "snsId": "SNS_E2E_001",
  "email": "e2e-test@example.com",
  "name": "E2E테스트유저"
}

> {%
    // response.body 는 이미 JSON 파싱된 객체임
    console.log("SNS 로그인 response.body =", response.body);

    const data = response.body.data;   // ✅ JSON.parse 필요 없음

    if (!data) {
        throw new Error("data 필드를 찾을 수 없습니다. ApiResponse 구조를 확인하세요.");
    }

    // ▶ 전역(Global) 변수로 저장
    client.global.set("accessToken", data.accessToken);
    client.global.set("refreshToken", data.refreshToken);
    client.global.set("memberId", String(data.id));

    console.log("=== SNS 로그인 성공 ===");
    console.log("memberId =", data.id);
    console.log("accessToken =", data.accessToken);
    console.log("refreshToken =", data.refreshToken);
%}

### 2. jwt-token-login - 리프레시 토큰으로 자동 로그인 (앱 재실행용)
POST {{baseUrl}}/api/member/auth/jwt-token-login
jwt-token: {{refreshToken}}

> {%
    // 디버그용: 현재 글로벌에 들어있는 값 확인
    console.log("jwt-token-login 에서 사용하는 refreshToken =", client.global.get("refreshToken"));

    const data = response.body.data;

    if (!data) {
        throw new Error("data 필드를 찾을 수 없습니다. ApiResponse 구조를 확인하세요.");
    }

    // 새 토큰 세트가 발급되면 다시 전역 변수 덮어쓰기
    if (data.accessToken) {
        client.global.set("accessToken", data.accessToken);
    }
    if (data.refreshToken) {
        client.global.set("refreshToken", data.refreshToken);
    }

    console.log("=== jwt-token-login 결과 ===");
    console.log("memberId =", data.id);
    console.log("new accessToken =", data.accessToken);
    console.log("new refreshToken =", data.refreshToken);
%}

### 3. logout - 현재 리프레시 토큰 폐기
POST {{baseUrl}}/api/member/auth/logout
jwt-token: {{refreshToken}}

> {%
    console.log("=== 로그아웃 요청 완료 ===");
    console.log("refreshToken(global) =", client.global.get("refreshToken"));
%}

### 4. (옵션) 로그아웃된 리프레시 토큰으로 다시 jwt-token-login 시도 → 실패 기대
POST {{baseUrl}}/api/member/auth/jwt-token-login
jwt-token: {{refreshToken}}